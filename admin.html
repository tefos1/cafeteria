<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8" />
    <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
    <style>
        body {
            font-family: Arial;
            background-color: #f8f8f8;
            direction: rtl;
            padding: 20px;
        }

        .order-card {
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 12px;
            margin: 15px auto;
            padding: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
        }

        select, button {
            margin-top: 10px;
            margin-left: 5px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <h2>ğŸ“‹ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
    <div id="ordersContainer">ğŸ”„ ØªØ­Ù…ÙŠÙ„...</div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        const correctPassword = "1982"; // ğŸ” ØºÙŠÙ‘Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ù„ÙŠ Ø¨Ø¯Ùƒ Ø¥ÙŠØ§Ù‡Ø§

        const entered = prompt("ğŸ” Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:");
        if (entered !== correctPassword) {
            alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
            document.body.innerHTML = "<h2 style='text-align:center;margin-top:100px;'>ğŸš« ØªÙ… Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„</h2>";
            throw new Error("Unauthorized access");
        }
        const firebaseConfig = {
            apiKey: "AIzaSyCu4ged4p8GzaQo4DFbY_sthYWHSvSYqpU",
            authDomain: "cafeteria-students-app.firebaseapp.com",
            databaseURL: "https://cafeteria-students-app-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "cafeteria-students-app",
            storageBucket: "cafeteria-students-app.appspot.com",
            messagingSenderId: "338557210649",
            appId: "1:338557210649:web:ba36c4623b4677ca585a88"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const container = document.getElementById("ordersContainer");

        function renderOrders(snapshot) {
            container.innerHTML = "";
            if (!snapshot.exists()) {
                container.innerHTML = "<p>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
                return;
            }

            snapshot.forEach(child => {
                const order = child.val();
                const id = order.code || child.key.slice(-6).toUpperCase();
                const itemsList = order.items?.map(item =>
                    `<li>${item.name} - â‚ª${item.price}${item.note ? " (Ù…Ù„Ø§Ø­Ø¸Ø§Øª: " + item.note + ")" : ""}</li>`
                ).join("") || "";

                const card = document.createElement("div");
                card.className = "order-card";
                card.innerHTML = `
              <h3>ğŸ§¾ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${id}</h3>
              <p><strong>ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</strong> ${order.pickupTime}</p>
              <p><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${order.notes || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}</p>
              <p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</strong> â‚ª${order.total || order.totalPrice || 0}</p>
              <p><strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> <span id="statusText-${child.key}" style="color:blue">${order.status || 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'}</span></p>
              <ul>${itemsList}</ul>

              <select id="statusSelect-${child.key}">
                <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ${order.status === "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ? "selected" : ""}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                <option value="Ø¬Ø§Ù‡Ø²" ${order.status === "Ø¬Ø§Ù‡Ø²" ? "selected" : ""}>Ø¬Ø§Ù‡Ø²</option>
                <option value="ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" ${order.status === "ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" ? "selected" : ""}>ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                <option value="Ø£ÙÙ„ØºÙŠ" ${order.status === "Ø£ÙÙ„ØºÙŠ" ? "selected" : ""}>Ø£ÙÙ„ØºÙŠ</option>
              </select>

              <button onclick="updateStatus('${child.key}', '${id}')">âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</button>
              <button onclick="deleteOrder('${child.key}')">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨</button>
            `;
                container.appendChild(card);
            });
        }

        db.ref("orders").on("value", renderOrders);

        function updateStatus(orderKey, orderCode) {
            const newStatus = document.getElementById(`statusSelect-${orderKey}`).value;
            firebase.database().ref("orders/" + orderKey + "/status").set(newStatus).then(() => {
                document.getElementById(`statusText-${orderKey}`).innerText = newStatus;

                const notification = {
                    orderId: orderCode,
                    message: `ğŸ“¢ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ø¥Ù„Ù‰: ${newStatus}`,
                    time: new Date().toISOString(),
                    read: false
                };
                firebase.database().ref("notifications").push(notification);

                if (newStatus === "ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…") {
                    setTimeout(() => {
                        firebase.database().ref("orders/" + orderKey).remove().then(() => location.reload());
                    }, 500);
                }
            }).catch(err => alert("âŒ Ø®Ø·Ø£: " + err));
        }

        function deleteOrder(orderKey) {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) {
                firebase.database().ref("orders/" + orderKey).remove().then(() => location.reload());
            }
        }
    </script>
</body>
</html>
